# ç®€ä»‹

@ldesign/publisher æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ä¼ä¸šçº§ NPM å‘å¸ƒç®¡ç†å·¥å…·ï¼Œæ—¨åœ¨ç®€åŒ–å’Œè‡ªåŠ¨åŒ–æ•´ä¸ªå‘å¸ƒæµç¨‹ã€‚

## ä»€ä¹ˆæ˜¯ Publisherï¼Ÿ

Publisher æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¸®åŠ©ä½ è‡ªåŠ¨åŒ– NPM åŒ…çš„å‘å¸ƒæµç¨‹ï¼Œä»ç‰ˆæœ¬ç®¡ç†ã€å˜æ›´æ—¥å¿—ç”Ÿæˆåˆ°å‘å¸ƒéªŒè¯å’Œé€šçŸ¥ï¼Œæä¾›ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚

## æ ¸å¿ƒåŠŸèƒ½

### ğŸ¯ æ™ºèƒ½ç‰ˆæœ¬ç®¡ç†

åŸºäº [Conventional Commits](https://www.conventionalcommits.org/) è§„èŒƒè‡ªåŠ¨æ¨èç‰ˆæœ¬å·ï¼š

- è‡ªåŠ¨åˆ†æ Git æäº¤å†å²
- æ™ºèƒ½æ¨èç‰ˆæœ¬é€’å¢ï¼ˆmajor/minor/patchï¼‰
- æ”¯æŒé¢„å‘å¸ƒç‰ˆæœ¬ï¼ˆbetaã€rc ç­‰ï¼‰
- ç¬¦åˆ [Semver](https://semver.org/) è§„èŒƒ

### ğŸ“ è‡ªåŠ¨ Changelog

è‡ªåŠ¨ç”Ÿæˆè§„èŒƒçš„å˜æ›´æ—¥å¿—ï¼š

- åŸºäº Conventional Commits è§£æ
- è‡ªåŠ¨åˆ†ç±»ï¼ˆFeaturesã€Bug Fixesã€Breaking Changes ç­‰ï¼‰
- æ”¯æŒ GitHub/GitLab/Gitee/Bitbucket é“¾æ¥
- åŒ…å«ä½œè€…ä¿¡æ¯å’Œ PR é“¾æ¥

### ğŸ”’ å¤š Registry æ”¯æŒ

çµæ´»çš„ Registry ç®¡ç†ï¼š

- æ”¯æŒ NPM å®˜æ–¹ Registry
- æ”¯æŒç§æœ‰ Registry
- Scope çº§åˆ«çš„ Registry æ˜ å°„
- å®‰å…¨çš„ Token ç®¡ç†
- 2FAï¼ˆåŒå› ç´ è®¤è¯ï¼‰æ”¯æŒ

### ğŸ¢ Monorepo å®Œæ•´æ”¯æŒ

ä¸º Monorepo é¡¹ç›®é‡èº«å®šåˆ¶ï¼š

- è‡ªåŠ¨æ£€æµ‹å·¥ä½œç©ºé—´
- ä¾èµ–å…³ç³»æ‹“æ‰‘æ’åº
- å¾ªç¯ä¾èµ–æ£€æµ‹å’ŒæŠ¥å‘Š
- æ‰¹é‡å¹¶è¡Œå‘å¸ƒ
- è‡ªåŠ¨æ›´æ–°å·¥ä½œç©ºé—´ä¾èµ–

### âœ… å…¨é¢çš„å‘å¸ƒéªŒè¯

å¤šé‡éªŒè¯ç¡®ä¿å‘å¸ƒå®‰å…¨ï¼š

- Git çŠ¶æ€æ£€æŸ¥ï¼ˆå·¥ä½œåŒºã€åˆ†æ”¯ï¼‰
- åŒ…å†…å®¹éªŒè¯ï¼ˆå¿…éœ€æ–‡ä»¶ï¼‰
- æ•æ„Ÿä¿¡æ¯æ‰«æï¼ˆ.envã€å¯†é’¥ç­‰ï¼‰
- ç¯å¢ƒæ£€æŸ¥ï¼ˆNode.jsã€NPM ç‰ˆæœ¬ï¼‰
- NPM å‡­è¯éªŒè¯

### ğŸ”„ å‘å¸ƒå›æ»š

å®Œæ•´çš„å›æ»šæ”¯æŒï¼š

- Unpublishï¼ˆ24å°æ—¶å†…ï¼‰
- Deprecateï¼ˆåºŸå¼ƒç‰ˆæœ¬ï¼‰
- Git Tag åˆ é™¤
- å›æ»šæŒ‡å¯¼å’Œå»ºè®®

### ğŸ”” é€šçŸ¥ç³»ç»Ÿ

å®æ—¶è·å–å‘å¸ƒçŠ¶æ€ï¼š

- é’‰é’‰ Webhook
- ä¼ä¸šå¾®ä¿¡ Webhook
- Slack
- é‚®ä»¶ï¼ˆSMTPï¼‰
- è‡ªå®šä¹‰ Webhook

### ğŸŒŸ é›¶é…ç½®å¼€å§‹

å¿«é€Ÿä¸Šæ‰‹ï¼š

- `init` å‘½ä»¤äº¤äº’å¼ç”Ÿæˆé…ç½®
- 5 ä¸ªé¢„è®¾æ¨¡æ¿
- å¸¦æ³¨é‡Šçš„é…ç½®æ–‡ä»¶
- å®Œæ•´çš„ç±»å‹æç¤º

### ğŸ©º ç¯å¢ƒè¯Šæ–­

è‡ªåŠ¨æ£€æµ‹é—®é¢˜ï¼š

- 8 é¡¹å…¨é¢æ£€æŸ¥
- è¯¦ç»†çš„ä¿®å¤å»ºè®®
- è¡¨æ ¼åŒ–å±•ç¤º
- JSON è¾“å‡ºæ”¯æŒ

### ğŸ” Dry-run å¢å¼º

å‘å¸ƒå‰é¢„è§ˆï¼š

- æ–‡ä»¶åˆ—è¡¨åˆ†æ
- åŒ…å¤§å°ä¼°ç®—
- 7 ç§é—®é¢˜æ£€æµ‹
- æ™ºèƒ½ä¼˜åŒ–å»ºè®®

### ğŸ“Š å‘å¸ƒç»Ÿè®¡

å®Œæ•´çš„å†å²è¿½è¸ªï¼š

- è‡ªåŠ¨è®°å½•å‘å¸ƒå†å²
- æˆåŠŸç‡ç»Ÿè®¡
- è€—æ—¶åˆ†æ
- è¶‹åŠ¿é¢„æµ‹

### âš¡ é«˜æ€§èƒ½

æ€§èƒ½ä¼˜åŒ–ï¼š

- å¹¶è¡Œå¤„ç†
- æ™ºèƒ½ç¼“å­˜ï¼ˆæ€§èƒ½æå‡ 60-70%ï¼‰
- LRU ç¼“å­˜ç­–ç•¥
- æ‰¹é‡å¹¶å‘å‘å¸ƒ

## ä¸ºä»€ä¹ˆé€‰æ‹© Publisherï¼Ÿ

### ç›¸æ¯”æ‰‹åŠ¨å‘å¸ƒ

- âœ… è‡ªåŠ¨åŒ–æ•´ä¸ªæµç¨‹
- âœ… å‡å°‘äººä¸ºé”™è¯¯
- âœ… èŠ‚çœå¤§é‡æ—¶é—´
- âœ… ç»Ÿä¸€å›¢é˜Ÿæ ‡å‡†

### ç›¸æ¯”å…¶ä»–å·¥å…·

| ç‰¹æ€§ | Publisher | Lerna | np | release-it |
|------|-----------|-------|-----|-----------|
| Monorepo æ”¯æŒ | âœ… å®Œæ•´ | âœ… | âŒ | éƒ¨åˆ† |
| é€šçŸ¥ç³»ç»Ÿ | âœ… 5ç§æ¸ é“ | âŒ | âŒ | æ’ä»¶ |
| ç¯å¢ƒè¯Šæ–­ | âœ… | âŒ | âŒ | âŒ |
| é…ç½®æ¨¡æ¿ | âœ… 5ä¸ª | âŒ | âŒ | âŒ |
| Dry-run åˆ†æ | âœ… è¯¦ç»† | åŸºç¡€ | åŸºç¡€ | åŸºç¡€ |
| å‘å¸ƒç»Ÿè®¡ | âœ… | âŒ | âŒ | âŒ |
| ç±»å‹å®‰å…¨ | âœ… TS | éƒ¨åˆ† | âŒ | éƒ¨åˆ† |
| ä¸­æ–‡æ–‡æ¡£ | âœ… å®Œæ•´ | éƒ¨åˆ† | âŒ | âŒ |

## è®¾è®¡ç†å¿µ

### 1. ç®€å•æ˜“ç”¨

- é›¶é…ç½®å¿«é€Ÿå¼€å§‹
- äº¤äº’å¼å‘å¯¼
- æ¸…æ™°çš„é”™è¯¯æç¤º
- å®Œå–„çš„æ–‡æ¡£

### 2. åŠŸèƒ½å®Œæ•´

- è¦†ç›–å‘å¸ƒå…¨æµç¨‹
- ä¼ä¸šçº§åŠŸèƒ½
- å¯æ‰©å±•æ€§å¼º

### 3. å®‰å…¨å¯é 

- å¤šé‡éªŒè¯
- æ•æ„Ÿä¿¡æ¯æ‰«æ
- Dry-run é¢„è§ˆ
- å›æ»šæ”¯æŒ

### 4. é«˜æ€§èƒ½

- å¹¶è¡Œå¤„ç†
- æ™ºèƒ½ç¼“å­˜
- ä¼˜åŒ–ç®—æ³•

### 5. å›¢é˜Ÿå‹å¥½

- é€šçŸ¥ç³»ç»Ÿ
- ç»Ÿä¸€æ ‡å‡†
- å®¡è®¡è¿½è¸ª

## é€‚ç”¨åœºæ™¯

### âœ… é€‚åˆ

- å•åŒ… NPM é¡¹ç›®
- Monorepo é¡¹ç›®
- å¼€æºé¡¹ç›®
- ä¼ä¸šå†…éƒ¨åŒ…
- éœ€è¦è‡ªåŠ¨åŒ–å‘å¸ƒçš„é¡¹ç›®
- éœ€è¦å›¢é˜Ÿåä½œçš„é¡¹ç›®

### âš ï¸ ä¸å¤ªé€‚åˆ

- é NPM åŒ…ï¼ˆå¦‚ Docker é•œåƒï¼‰
- ä¸éœ€è¦ç‰ˆæœ¬ç®¡ç†çš„é¡¹ç›®
- ä¸€æ¬¡æ€§å‘å¸ƒçš„åŒ…

## ç³»ç»Ÿè¦æ±‚

- Node.js >= 18.0.0
- pnpm >= 8.0.0ï¼ˆæ¨èï¼‰æˆ– npm/yarn
- Git >= 2.0.0
- NPM è´¦å·ï¼ˆç”¨äºå‘å¸ƒï¼‰

## å·¥ä½œåŸç†

Publisher çš„å·¥ä½œæµç¨‹ï¼š

```mermaid
graph TD
    A[å¼€å§‹] --> B[åˆå§‹åŒ–é…ç½®]
    B --> C[ç¯å¢ƒè¯Šæ–­]
    C --> D[æ›´æ–°ç‰ˆæœ¬å·]
    D --> E[ç”Ÿæˆ Changelog]
    E --> F[éªŒè¯æ£€æŸ¥]
    F --> G{é€šè¿‡ï¼Ÿ}
    G -->|æ˜¯| H[æ„å»º]
    G -->|å¦| Z[ç»ˆæ­¢]
    H --> I[å‘å¸ƒåˆ° Registry]
    I --> J[Git æ“ä½œ]
    J --> K[å‘é€é€šçŸ¥]
    K --> L[è®°å½•ç»Ÿè®¡]
    L --> M[å®Œæˆ]
```

## æ¶æ„æ¦‚è§ˆ

```
Publisher
â”œâ”€â”€ CLI Layer          # å‘½ä»¤è¡Œæ¥å£
â”œâ”€â”€ Core Layer         # æ ¸å¿ƒç®¡ç†å™¨
â”‚   â”œâ”€â”€ PublishManager
â”‚   â”œâ”€â”€ VersionManager
â”‚   â”œâ”€â”€ ChangelogGenerator
â”‚   â”œâ”€â”€ NotificationManager
â”‚   â””â”€â”€ ...
â”œâ”€â”€ Validators         # éªŒè¯å™¨
â”œâ”€â”€ Utils              # å·¥å…·å‡½æ•°
â””â”€â”€ Types              # ç±»å‹å®šä¹‰
```

## è®¸å¯è¯

[MIT License](https://github.com/ldesign/packages/publisher/blob/main/LICENSE)

## ä¸‹ä¸€æ­¥

- ğŸ“– é˜…è¯»[å¿«é€Ÿå¼€å§‹](/guide/getting-started)å¼€å§‹ä½¿ç”¨
- ğŸ”§ äº†è§£[é…ç½®é€‰é¡¹](/config/overview)
- ğŸ’¡ æŸ¥çœ‹[æœ€ä½³å®è·µ](/guide/project-setup)
- ğŸ¢ å¦‚æœä½¿ç”¨ Monorepoï¼ŒæŸ¥çœ‹ [Monorepo æŒ‡å—](/guide/monorepo)

## è·å–å¸®åŠ©

- ğŸ’¬ [GitHub Issues](https://github.com/ldesign/packages/publisher/issues)
- ğŸ“– [å®Œæ•´æ–‡æ¡£](/)
- ğŸ” ä½¿ç”¨å³ä¸Šè§’æœç´¢åŠŸèƒ½
